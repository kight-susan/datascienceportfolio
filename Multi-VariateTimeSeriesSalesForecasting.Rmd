---
title: "Multi-Variate Time Series Data for Sales Forecasting by Strategy Type"
author: "Susan Kight"
date: "Updated: `r format(Sys.time(), '%B %e, %Y')`"
output: html_notebook
---

----

# Preparation


```{r}
# install.packages(c("ggplot2", "forecast"))
source("code_Time_Series.R")
```

# Data and Getting Started

The data set for this example contains annual sales and advertising dollars 
(in 1960 dollars) for the Lydia Pinkham tonic from 1907 to 1960.These series 
are stored in two different objects called `tonic_sales` and `tonic_advert`, 
respectively.

Different advertising strategies were adopted from 1907-1914 (strategy A), 
1915-1925 (B), 1926-1940 (C), and 1941-1960 (D). The advertising strategy 
is included using three dummy variables, `tonic_strat_B`, `tonic_strat_C`, 
and `tonic_strat_D`, with strategy A being the base case.

Also included are the first lags of sales and advertising in the series
`tonic_lag_sales` and `tonic_lag_advert`. In all of seven of these series, 
the observation for 1907 has been removed to make all the series the same 
length due to the `NA`'s introduced by these lags.


```{r}
load("data_Time_Series.Rdata")
```

```{r}
# tonic_sales
# tonic_advert
# tonic_strat_B
# tonic_strat_C
# tonic_strat_D
# tonic_lag_sales
# tonic_lag_advert
```

Used the `autoplot(...)` to print each of the series one by one. Reviewed to see if
advertising and sales seem correlated. Whether advertising follows sales, or
do sales follow advertising.

```{r}
# autoplot(tonic_sales)
# autoplot(tonic_advert)
# autoplot(tonic_strat_B)
# autoplot(tonic_strat_C)
# autoplot(tonic_strat_D)
# autoplot(tonic_lag_sales)
# autoplot(tonic_lag_advert)
```

# Just Sales and Advertising

Let's start by first regressing `tonic_sales` on `tonic_advertising` to analyze the fit.

```{r}
fit <- tslm(tonic_sales ~ tonic_advert)
aa_plot_fitted(fit)
```

The fit doesn't look so great. Let's also check the diagnostics.

```{r}
accuracy(fit)
```

```{r}
summary(fit)
```

```{r}
checkresiduals(fit)
```

From above, it's clear we are having trouble with autocorrelation. Maybe adding the lag
1 of advertising will help.

```{r}
fit <- tslm(tonic_sales ~ tonic_advert + tonic_lag_advert)
checkresiduals(fit)
```

That didn't seem to help the autocorrelation at all. Will now add lag 1 of 
sales to see if that helps improve the model.

```{r}
fit <- tslm(tonic_sales ~ tonic_advert + tonic_lag_advert + tonic_lag_sales)
checkresiduals(fit)
```

Clearly that is much better! Let's verify the fit visually:

```{r}
aa_plot_fitted(fit)
```

Looks pretty good. Finally, let's look at accuracy and verify variable significance:

```{r}
accuracy(fit)
```


```{r}
summary(fit)
```

The MAPE is about 7%, and all variables are significant. This seems like a good model.

# Adding in the Advertising Strategy

Now adding in the advertising strategy (without trying to remove insignificant variables):

```{r}
fit <- tslm(tonic_sales ~ tonic_advert + tonic_lag_advert + tonic_lag_sales +
    tonic_strat_B + tonic_strat_C + tonic_strat_D)
```

```{r}
aa_plot_fitted(fit)
```

```{r}
accuracy(fit)
```

```{r}
summary(fit)
```

```{r}
checkresiduals(fit)
```

All in all, this model looks quite good, and its error measures are better than the 
previous one without the strategies.


# Final Thought: Forecasting

Since the model for forecasting `tonic_sales` is based on other time series, we have to forecast 
those time series first. 

Let's pretend it's 1960 (the last year in the data), and we want to forecast `tonic_sales` for 1961.

Here's the sales amount from 1960:

```{r}
window(tonic_sales, start = 1960, end = 1960)
```
And here's the advertising amount from 1960:

```{r}
window(tonic_advert, start = 1960, end = 1960)
```


Let's suppose that, in 1961, we will stick with strategy D and we plan
to spend 500 on advertising. Then we can predict `tonic_sales` in 1961 as
follows using the above formula:

```{r}
128.87047 +          # intercept
    0.60279 * 500 +  # contribution from advertising
   -0.37913 * 564 +  # uses lagged advertising from 1960!
    0.76540 * 1289 + # uses lagged sales from 1960!
    104.99736        # contribution from strategy D
```

